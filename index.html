<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Hub</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --tg-color: #2481cc; --bg: #efeff4; }
        body { font-family: sans-serif; background: var(--bg); margin: 0; padding-bottom: 70px; }
        
        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è (–¢–∞–±—ã) */
        .tab-bar { position: fixed; bottom: 0; width: 100%; background: white; display: flex; border-top: 1px solid #ccc; }
        .tab { flex: 1; text-align: center; padding: 15px; cursor: pointer; color: #888; }
        .tab.active { color: var(--tg-color); font-weight: bold; }

        /* –ö–æ–Ω—Ç–µ–Ω—Ç */
        .page { display: none; padding: 20px; }
        .page.active { display: block; }

        /* –°–ø–∏—Å–æ–∫ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
        .card { background: white; padding: 15px; border-radius: 12px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .done { text-decoration: line-through; color: #aaa; }
        
        input { width: 70%; padding: 10px; border: 1px solid #ccc; border-radius: 8px; }
        .add-btn { background: var(--tg-color); color: white; border: none; padding: 10px; border-radius: 8px; }
    </style>
</head>
<body>

    <!-- –¢–∞–± 1: –ü–æ–∫—É–ø–∫–∏ -->
    <div id="shopping_page" class="page active">
        <h2>üõí –ü–æ–∫—É–ø–∫–∏</h2>
        <div style="margin-bottom: 20px;">
            <input type="text" id="shop_input" placeholder="–ß—Ç–æ –∫—É–ø–∏—Ç—å?">
            <button class="add-btn" onclick="addItem('shopping', 'shop_input')">‚ûï</button>
        </div>
        <div id="shop_list"></div>
    </div>

    <!-- –¢–∞–± 2: –î–∞—Ç—ã -->
    <div id="events_page" class="page">
        <h2>üìÖ –í–∞–∂–Ω—ã–µ –¥–∞—Ç—ã</h2>
        <div style="margin-bottom: 20px;">
            <input type="text" id="event_input" placeholder="–ò–º—è | 25.12">
            <button class="add-btn" onclick="addItem('events', 'event_input')">‚ûï</button>
        </div>
        <div id="event_list"></div>
    </div>

    <!-- –¢–∞–± 3: –ü–∞—Ä–æ–ª–∏ -->
    <div id="pass_page" class="page">
        <h2>üîë –ü–∞—Ä–æ–ª–∏</h2>
        <div style="margin-bottom: 20px;">
            <input type="text" id="pass_input" placeholder="–°–µ—Ä–≤–∏—Å | –ü–∞—Ä–æ–ª—å">
            <button class="add-btn" onclick="addItem('passwords', 'pass_input')">‚ûï</button>
        </div>
        <div id="pass_list"></div>
    </div>

    <div class="tab-bar">
        <div class="tab active" onclick="showPage('shopping_page', this)">üõí</div>
        <div class="tab" onclick="showPage('events_page', this)">üìÖ</div>
        <div class="tab" onclick="showPage('pass_page', this)">üîë</div>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        let urlParams = new URLSearchParams(window.location.search);
        let userId = urlParams.get('user_id');
        let API_URL = window.location.origin; // –°–µ—Ä–≤–µ—Ä —Ç–∞–º –∂–µ, –≥–¥–µ –∏ —Å–∞–π—Ç (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç—É–Ω–Ω–µ–ª—å)

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
        function showPage(pageId, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            el.classList.add('active');
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å —Å–µ—Ä–≤–µ—Ä–∞
        async function loadData() {
            let res = await fetch(`${API_URL}/get_data?user_id=${userId}`);
            let data = await res.json();
            
            // –†–µ–Ω–¥–µ—Ä–∏–º –ø–æ–∫—É–ø–∫–∏
            document.getElementById('shop_list').innerHTML = data.shopping.map(i => `
                <div class="card ${i.done ? 'done' : ''}" onclick="toggleItem(${i.id})">
                    ${i.text} <span>${i.done ? '‚úÖ' : '‚è≥'}</span>
                </div>
            `).join('');

            // –†–µ–Ω–¥–µ—Ä–∏–º –¥–∞—Ç—ã
            document.getElementById('event_list').innerHTML = data.events.map(i => `
                <div class="card"><b>${i.title}</b> <span>${i.date}</span></div>
            `).join('');

            // –†–µ–Ω–¥–µ—Ä–∏–º –ø–∞—Ä–æ–ª–∏
            document.getElementById('pass_list').innerHTML = data.passwords.map(i => `
                <div class="card"><b>${i.service}</b> <code>${i.pass}</code></div>
            `).join('');
        }

        async function addItem(table, inputId) {
            let text = document.getElementById(inputId).value;
            await fetch(`${API_URL}/add_data`, {
                method: 'POST',
                body: JSON.stringify({user_id: userId, text: text, table: table})
            });
            document.getElementById(inputId).value = '';
            loadData();
        }

        async function toggleItem(id) {
            await fetch(`${API_URL}/toggle_item`, {
                method: 'POST',
                body: JSON.stringify({id: id})
            });
            loadData();
        }

        loadData();
    </script>
</body>
</html>
